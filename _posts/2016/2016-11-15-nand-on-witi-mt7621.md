---
layout: post
title:  "为WiTi MT7621 Board加上NAND"
date:   2016-11-15 14:20:33
---
## 缘起
一般的MT7621板子都是SPI flash，NAND的很少见。恰好WiTi这个板子已经预留了焊盘，所以一直琢磨补上去。后来更换SPI flash的时候不小心把flash焊盘给弄掉了，这下只能用NAND了。吐槽下这个板子，表面做工可以，其实用料很省，塑料的热风枪一吹就变形。

## 几种方案
- 板子导出了JTAG口，如果能直接用JTAG写入NAND那肯定是最方便的。我试过用Raspberry Pi的GPIO连接，可以detect到四个CPU。后来换成Bus Blaster，可以直接在Windows上面运行命令。不过后续还是很困难，直接写入NAND的话需要NAND控制器的驱动，如果先把uboot load到内存中直接启动，这个要初始化板子的配置文件，里面要操作各种寄存器，可能要深入理解uboot后才知道怎么做。总的来说JTAG很强大，但是太底层。
- 从SPI启动OpenWrt后，在OpenWrt里面直接用`nand write`命令操作NAND。这种方式不行，似乎因为MT7621的SPI和NAND有复用IO，在OpenWrt里面支持并不完善。
- 从SPI启动到uboot，在uboot里面写入NADN。

## uboot
....

## 启动开关
<img src="/images/2016/mt7621-boot.png">


<img src="/images/2016/mt7621-nand.jpg">
